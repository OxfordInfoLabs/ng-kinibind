!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("lodash"),require("@angular/router"),require("@angular/forms"),require("@angular/common")):"function"==typeof define&&define.amd?define("ng-kinibind",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","lodash","@angular/router","@angular/forms","@angular/common"],e):e(t["ng-kinibind"]={},t.ng.core,t.ng.common.http,t.rxjs,t.rxjs.operators,null,t.ng.router,t.ng.forms,t.ng.common)}(this,function(t,i,s,a,n,o,e,r,u){"use strict";var l=function(){function t(t){this.http=t,this.jsonpRequestError=new i.EventEmitter}return t.prototype.makeRequest=function(t,e,r){return void 0===r&&(r={}),this.http.request(t,e,r)},t.prototype.makePostRequest=function(t,e,r){return void 0===r&&(r={}),this.http.post(t,e,r)},t.prototype.makeGetRequest=function(t,e){return void 0===e&&(e={}),this.http.get(t,e)},t.prototype.makeJsonpRequest=function(t,e){var r=this,i={headers:new s.HttpHeaders({"Content-Type":"application/json"})};return e.callback="JSONP_CALLBACK",i.params=e,this.http.request("jsonp",t,i).pipe(n.map(function(t){return t}),n.catchError(function(t){return t.error instanceof Error?console.error("An error occurred:",t.error.message):console.error("Backend returned code "+t.status+", body was: "+t.error),r.jsonpRequestError.emit(t),a.EMPTY}))},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:s.HttpClient}]},t}(),p=function(){function t(t,e){this.http=t,this.kbRequest=e,this.reloadTrigger=new i.EventEmitter,this.onLoad=new i.EventEmitter,this.onLoadError=new i.EventEmitter}return t.prototype.ngOnInit=function(){var e=this;this.reloadTrigger.subscribe(function(){e.data.filters.filterObject={},e.data.pageOptions.index=1}),this.data.filters.changes.subscribe(function(){return e.data.pageOptions.index=1}),a.merge(this.data.filters.changes,this.data.pageOptions.changes,this.reloadTrigger).pipe(n.startWith({}),n.switchMap(function(){return e.getData()}),n.map(function(t){return o.isPlainObject(t)?t.results&&o.isArray(t.results)?(e.data.totalCount=t.totalCount||t.results.length,t.results):t:(o.isArray(t)&&(e.data.totalCount=t.length),t)}),n.catchError(function(t){return e.onLoadError.emit(t),a.of([])})).subscribe(function(t){o.isPlainObject(t)?e.data.item=t:o.isArray(t)?e.data.results=t:e.data.value=t,e.onLoad.emit({success:!0})})},t.prototype.getData=function(){var t=this.sourceParams||{};o.isEmpty(this.data.filters.filterObject)||(t.filters=this.data.filters.filterObject),this.data.pageOptions.size&&(t.pageSize=this.data.pageOptions.size,t.page=this.data.pageOptions.index);var e=this.method?this.method:this.sourceParams?"POST":"GET";return this.kbRequest.makeRequest(e,this.url,{params:t})},t.decorators=[{type:i.Directive,args:[{selector:"kb-bind"}]}],t.ctorParameters=function(){return[{type:s.HttpClient},{type:l}]},t.propDecorators={url:[{type:i.Input,args:["source"]}],method:[{type:i.Input,args:["method"]}],sourceParams:[{type:i.Input,args:["sourceParams"]}],data:[{type:i.Input,args:["model"]}],withCredentials:[{type:i.Input,args:["withCredentials"]}],reloadTrigger:[{type:i.Input,args:["reloadTrigger"]}],onLoad:[{type:i.Output,args:["onLoad"]}],onLoadError:[{type:i.Output,args:["onLoadError"]}]},t}(),c=function(){function t(t){this.kbRequest=t,this.filterValues=[]}return t.prototype.ngOnInit=function(){var e=this;this.initialFilterValues&&(this.data.filters.filterObject=o.extend(this.initialFilterValues,this.data.filters.filterObject)),this.getData(this.data.filters.filterObject).subscribe(function(t){e.filterValues=t})},t.prototype.updateFilter=function(t){if(t.selected=!t.selected,this.data.filters.filterObject||(this.data.filters.filterObject={}),this.multiple)if(t.selected)Array.isArray(this.data.filters.filterObject[this.filter])?this.data.filters.filterObject[this.filter].push(t.value):this.data.filters.filterObject[this.filter]=[t.value];else{var e=this.data.filters.filterObject[this.filter].indexOf(t.value);-1<e&&this.data.filters.filterObject[this.filter].splice(e,1),this.data.filters.filterObject[this.filter].length||delete this.data.filters.filterObject[this.filter]}else t.selected?this.data.filters.filterObject[this.filter]=t.value:delete this.data.filters.filterObject[this.filter];this.getData(this.data.filters.filterObject),this.data.filters.changes.next(!0)},t.prototype.getData=function(t){var e={seedColumn:this.filter,filters:t};return this.kbRequest.makePostRequest(this.url,e)},t.decorators=[{type:i.Component,args:[{selector:"kb-filter",template:'<div *ngFor="let filterValue of filterValues">\n    <div *ngIf="multiple">\n        <input type="checkbox" (change)="updateFilter(filterValue)"/>\n        {{filterValue.label}}\n        <span *ngIf="showCount">({{filterValue.count}})</span>\n    </div>\n\n    <a *ngIf="!multiple" href="javascript:void(0)"\n       [style.font-weight]="filterValue.selected ? \'bold\' : \'normal\'" (click)="updateFilter(filterValue)">\n        {{filterValue.label}}\n        <span *ngIf="showCount">({{filterValue.count}})</span>\n    </a>\n</div>\n',styles:[""]}]}],t.ctorParameters=function(){return[{type:l}]},t.propDecorators={url:[{type:i.Input,args:["source"]}],data:[{type:i.Input,args:["model"]}],multiple:[{type:i.Input,args:["multiple"]}],showCount:[{type:i.Input,args:["showCount"]}],filter:[{type:i.Input,args:["filter"]}],initialFilterValues:[{type:i.Input,args:["initialFilterValues"]}],withCredentials:[{type:i.Input,args:["withCredentials"]}]},t}(),h=function(){function t(){}return t.prototype.updateFilter=function(t){this.constructFilterObject(t)},t.prototype.constructFilterObject=function(t){if(null===t)delete this.data.filters.filterObject[this.filter];else{var e=t;this.prefix&&(e=this.prefix+e),this.suffix&&(e+=this.suffix),this.data.filters.filterObject[this.filter]={filterValue:e,filterColumns:this.columns?this.columns.split(","):[]},this.mode&&(this.data.filters.filterObject[this.filter].filterMode=this.mode),this.dateFormat&&(this.data.filters.filterObject[this.filter].filterDateFormat=this.dateFormat)}this.data.filters.changes.next(!0)},t.decorators=[{type:i.Directive,args:[{selector:"[kbFilterElement]",exportAs:"filterElement"}]}],t.ctorParameters=function(){return[]},t.propDecorators={data:[{type:i.Input,args:["model"]}],filter:[{type:i.Input,args:["filter"]}],prefix:[{type:i.Input,args:["prefix"]}],suffix:[{type:i.Input,args:["suffix"]}],columns:[{type:i.Input,args:["columns"]}],filterClass:[{type:i.Input,args:["filterClass"]}],mode:[{type:i.Input,args:["mode"]}],dateFormat:[{type:i.Input,args:["dateFormat"]}]},t}(),d=function(){function t(t,e,r){this.http=t,this.router=e,this.kbRequest=r,this.onSave=new i.EventEmitter,this.onError=new i.EventEmitter}return t.prototype.onClick=function(t){this.save()},t.prototype.ngOnInit=function(){},t.prototype.save=function(){var t,e=this;this.model&&(0<this.model.results.length?t=this.model.results:this.model.item&&(t=this.model.item));var r=this.method||"POST";this.kbRequest.makeRequest(r,this.storeURL,{withCredentials:this.withCredentials||!1,params:t}).toPromise().then(function(t){e.savedRoute&&e.router.navigate([e.savedRoute]),e.onSave.emit({results:t})})["catch"](function(t){e.onError.emit(t)})},t.decorators=[{type:i.Directive,args:[{selector:"[kbSave]"}]}],t.ctorParameters=function(){return[{type:s.HttpClient},{type:e.Router},{type:l}]},t.propDecorators={model:[{type:i.Input,args:["model"]}],storeURL:[{type:i.Input,args:["store"]}],method:[{type:i.Input,args:["method"]}],savedRoute:[{type:i.Input,args:["savedRoute"]}],withCredentials:[{type:i.Input,args:["withCredentials"]}],onSave:[{type:i.Output,args:["onSave"]}],onError:[{type:i.Output,args:["onError"]}],onClick:[{type:i.HostListener,args:["click",["$event"]]}]},t}(),f=function(){function t(t,e,r){this.ngForm=t,this.router=e,this.kbRequest=r,this.onLoad=new i.EventEmitter,this.onLoadError=new i.EventEmitter,this.onSave=new i.EventEmitter,this.onError=new i.EventEmitter}return t.prototype.ngOnInit=function(){this.initSourceData(),this.initSaveData()},t.prototype.initSourceData=function(){var e=this;this.data.filters.changes.subscribe(function(){return e.data.pageOptions.index=0}),a.merge(this.data.filters.changes,this.data.pageOptions.changes).pipe(n.startWith({}),n.switchMap(function(){return e.getData()}),n.map(function(t){return o.isPlainObject(t)?t.results&&o.isArray(t.results)?(e.data.totalCount=t.totalCount||t.results.length,t.results):t:o.isArray(t)?(e.data.totalCount=t.length,t):void 0}),n.catchError(function(t){return e.onLoadError.emit(t),a.of([])})).subscribe(function(t){o.isPlainObject(t)?e.data.item=t:e.data.results=t,e.onLoad.emit({success:!0})})},t.prototype.getData=function(){var t=this.sourceParams||{};o.isEmpty(this.data.filters.filterObject)||(t.filters=this.data.filters.filterObject),this.data.pageOptions.size&&(t.pageSize=this.data.pageOptions.size,t.page=this.data.pageOptions.index);var e=this.sourceMethod?this.sourceMethod:this.sourceParams?"POST":"GET";return this.kbRequest.makeRequest(e,this.url,{params:this.sourceParams,withCredentials:this.withCredentials})},t.prototype.initSaveData=function(){var t=this;this.storeURL&&this.ngForm.ngSubmit.subscribe(function(){if(0<t.data.results.length)if(t.dirtyOnly){var r=[];o.forEach(t.ngForm.form.controls,function(t,e){t.dirty&&r.push(e)}),0<r.length&&t.saveData(r)}else t.saveData();else t.data.item&&t.ngForm.dirty&&t.saveData()})},t.prototype.saveData=function(t){var i=this,e={};if(t){var s=[];t.forEach(function(t){var e=t.split("-"),r=o.find(e,function(t){return!isNaN(Number(t))});s.push(i.data.results[r])}),e=s}else 0<this.data.results.length?e=this.data.results:this.data.item&&(e=this.data.item);var r=this.storeMethod?this.storeMethod:"POST";this.kbRequest.makeRequest(r,this.storeURL,{params:e,withCredentials:this.withCredentials}).toPromise().then(function(t){i.savedRoute&&i.router.navigate([i.savedRoute]),i.onSave.emit({results:t})})["catch"](function(t){i.onError.emit(t)})},t.decorators=[{type:i.Directive,args:[{selector:"[kbForm]"}]}],t.ctorParameters=function(){return[{type:r.NgForm},{type:e.Router},{type:l}]},t.propDecorators={url:[{type:i.Input,args:["source"]}],sourceMethod:[{type:i.Input,args:["sourceMethod"]}],sourceParams:[{type:i.Input,args:["sourceParams"]}],data:[{type:i.Input,args:["model"]}],storeURL:[{type:i.Input,args:["store"]}],storeMethod:[{type:i.Input,args:["storeMethod"]}],savedRoute:[{type:i.Input,args:["savedRoute"]}],dirtyOnly:[{type:i.Input,args:["dirtyOnly"]}],withCredentials:[{type:i.Input,args:["withCredentials"]}],onLoad:[{type:i.Output,args:["onLoad"]}],onLoadError:[{type:i.Output,args:["onLoadError"]}],onSave:[{type:i.Output,args:["onSave"]}],onError:[{type:i.Output,args:["onError"]}]},t}();var m=function(){function t(){}return t.prototype.validate=function(t){return this.matchRegex?function r(e){return function(t){return e.test(t.value)?null:{matchRegex:{value:t.value}}}}(new RegExp(this.matchRegex,"i"))(t):null},t.decorators=[{type:i.Directive,args:[{selector:"[kbMatchRegex]",providers:[{provide:r.NG_VALIDATORS,useExisting:t,multi:!0}]}]}],t.propDecorators={matchRegex:[{type:i.Input,args:["kbMatchRegex"]}]},t}(),g=function(){function t(t){this.kbRequest=t,this.remoteObjectParams={}}return t.prototype.validate=function(t){return this.remoteValidate?this.remoteValidateValidator(this.remoteValidate)(t):null},t.prototype.remoteValidateValidator=function(e){var r=this;return function(t){return r.remoteObjectParams[r.remoteObjectParam]=t.value,t.value?r.kbRequest.makePostRequest(e,r.remoteObjectParams).toPromise().then(function(t){return t?null:{remoteValidate:!1}}):Promise.resolve(null)}},t.decorators=[{type:i.Directive,args:[{selector:"[kbRemoteValidate]",providers:[{provide:r.NG_ASYNC_VALIDATORS,useExisting:t,multi:!0}]}]}],t.ctorParameters=function(){return[{type:l}]},t.propDecorators={remoteValidate:[{type:i.Input,args:["kbRemoteValidate"]}],remoteObjectParam:[{type:i.Input,args:["remoteObjectParam"]}],remoteObjectParams:[{type:i.Input,args:["remoteObjectParams"]}]},t}(),y=function(){function t(t){this.kbRequest=t,this.started=new i.EventEmitter,this.completed=new i.EventEmitter,this.error=new i.EventEmitter}return t.prototype.clickEvent=function(t){var e=this;t.preventDefault(),t.stopPropagation(),this.started.emit(!0);var r=this.method?this.method:this.actionParams?"POST":"GET";this.kbRequest.makeRequest(r,this.actionURL,{params:this.actionParams}).toPromise().then(function(t){e.completed.emit(t)})["catch"](function(t){e.error.emit(t)})},t.prototype.ngOnInit=function(){},t.decorators=[{type:i.Directive,args:[{selector:"[kbAction]"}]}],t.ctorParameters=function(){return[{type:l}]},t.propDecorators={actionURL:[{type:i.Input,args:["actionURL"]}],method:[{type:i.Input,args:["method"]}],actionParams:[{type:i.Input,args:["actionParams"]}],started:[{type:i.Output,args:["started"]}],completed:[{type:i.Output,args:["completed"]}],error:[{type:i.Output,args:["error"]}],clickEvent:[{type:i.HostListener,args:["click",["$event"]]}]},t}(),v=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[u.CommonModule,s.HttpClientModule,r.FormsModule,s.HttpClientJsonpModule],declarations:[p,c,d,h,f,m,g,y],exports:[p,d,c,h,f,m,g,y],providers:[l]}]}],t}(),b=function(){function t(t,e){this.results=[],this.item={},this.value="",this.totalCount=0,this.offset=e||0,this.filters={changes:new a.Subject,filterObject:{}},this.pageOptions={changes:new a.Subject,size:t,index:1,options:[10,25,50,100]}}return t.prototype.setPageOptions=function(t,e){this.pageOptions.size=t,this.pageOptions.index=e,this.offset=t*e,this.pageOptions.changes.next(!0)},t}();t.NgKinibindModule=v,t.KinibindRequestService=l,t.KinibindModel=b,t.ɵh=y,t.ɵc=d,t.ɵa=p,t.ɵd=h,t.ɵb=c,t.ɵe=f,t.ɵf=m,t.ɵg=g,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ng-kinibind.umd.min.js.map